@page "/"
@rendermode InteractiveServer
@inject IHttpClientFactory ClientFactory
@using MP_Project.Shared

<div class="content-card">

    <!-- TITLE -->
    <div class="section-title">
        Item List
    </div>

    <!-- SEARCH -->
    <div class="search-bar-container">
        <input type="text"
               placeholder="Search product..."
               @bind="searchText"
               @bind:event="oninput" />
    </div>

    <!-- PRODUCT LIST -->
    <div class="product-list">

        @foreach (var product in FilteredProducts)
        {
            <div class="product-row">

                <div class="product-image-box">
                    @if (!string.IsNullOrWhiteSpace(product.Image))
                    {
                        <img src="@product.Image" alt="@product.ProductName" />
                    }
                    else
                    {
                        <span>No Image</span>
                    }
                </div>

                <div class="product-info-box">

                    <div class="product-meta">
                        <span><strong>ID:</strong> @product.ProductId</span>

                        <span>
                            <strong>Quantity:</strong> @product.StockCount
                            <span class="stock-badge @GetStockClass(product.StockCount)">
                                @GetStockLabel(product.StockCount)
                            </span>
                        </span>
                    </div>

                    <p class="product-description-text">
                        @product.ProductDescription
                    </p>

                </div>

            </div>
        }

    </div>

</div>
@code {

    private List<Product> products = new();
    private string searchText = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var http = ClientFactory.CreateClient("API");
        var result = await http.GetFromJsonAsync<List<Product>>("api/products");
        if (result != null)
            products = result;
    }

    private IEnumerable<Product> FilteredProducts =>
        string.IsNullOrWhiteSpace(searchText)
            ? products
            : products.Where(p =>
                p.ProductName != null &&
                p.ProductName.Contains(searchText, StringComparison.OrdinalIgnoreCase));

    private string GetStockClass(int stock)
    {
        if (stock <= 10)
            return "stock-red";

        if (stock <= 20)
            return "stock-orange";

        return "stock-green";
    }

    private string GetStockLabel(int stock)
    {
        if (stock <= 10)
            return "Low";

        if (stock <= 20)
            return "Medium";

        return "Good";
    }


}